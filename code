#include <WiFi.h>
#include <WebServer.h>

/* ---------- ESP32 AP Credentials ---------- */
const char* ap_ssid = "ESP32_LED";
const char* ap_password = "12345678";   // min 8 chars

/* ---------- Web Server ---------- */
WebServer server(80);

/* ---------- GPIO Pins ---------- */
const int LED1 = 2;   // GPIO2
const int LED2 = 4;   // GPIO4

/* ---------- LED States ---------- */
bool led1State = false;
bool led2State = false;

void setup() {
  Serial.begin(115200);

  pinMode(LED1, OUTPUT);
  pinMode(LED2, OUTPUT);

  digitalWrite(LED1, LOW);
  digitalWrite(LED2, LOW);

  /* ---------- Start ESP32 Access Point ---------- */
  WiFi.softAP(ap_ssid, ap_password);

  Serial.println("ESP32 Access Point Started");
  Serial.print("AP IP Address: ");
  Serial.println(WiFi.softAPIP());   // 192.168.4.1

  /* ---------- URL Handlers ---------- */
  server.on("/", handleRoot);
  server.on("/led1", toggleLED1);
  server.on("/led2", toggleLED2);

  server.begin();
  Serial.println("Web Server Started");
}

void loop() {
  server.handleClient();
}

/* ---------- Web Page ---------- */
void handleRoot() {
  String html = "<!DOCTYPE html><html><head>";
  html += "<meta name='viewport' content='width=device-width, initial-scale=1'>";
  html += "<style>";
  html += "body{font-family:Arial;text-align:center;}";
  html += "button{width:180px;height:50px;font-size:20px;margin:10px;}";
  html += "</style></head><body>";

  html += "<h2>ESP32 LED Control</h2>";

  html += "<p>LED 1 Status: <b>";
  html += led1State ? "ON" : "OFF";
  html += "</b></p>";
  html += "<a href='/led1'><button>";
  html += led1State ? "Turn OFF" : "Turn ON";
  html += "</button></a>";

  html += "<p>LED 2 Status: <b>";
  html += led2State ? "ON" : "OFF";
  html += "</b></p>";
  html += "<a href='/led2'><button>";
  html += led2State ? "Turn OFF" : "Turn ON";
  html += "</button></a>";

  html += "</body></html>";
  server.send(200, "text/html", html);
}

/* ---------- Toggle LED 1 ---------- */
void toggleLED1() {
  led1State = !led1State;
  digitalWrite(LED1, led1State);
  server.sendHeader("Location", "/");
  server.send(303);
}

/* ---------- Toggle LED 2 ---------- */
void toggleLED2() {
  led2State = !led2State;
  digitalWrite(LED2, led2State);
  server.sendHeader("Location", "/");
  server.send(303);
}
